<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Horarios Disponibles</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/new-table.css}">
</head>
<body>
<div class="container py-4">
    <h1 class="text-center mb-4">Horarios Disponibles</h1>

    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead class="table-light">
            <tr>
                <th scope="col">Fecha</th>
                <th scope="col">Hora</th>
                <th scope="col">Profesional</th>
                <th scope="col">Acción</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="appointment : ${professionalService.appointments}" th:if="${appointment.client == null}">
                <td th:text="${appointment.date}"></td>
                <td th:text="${appointment.time}"></td>
                <td th:text="${appointment.professional.name}"></td>
                <td>
                    <button class="btn btn-primary btn-sm"
                            th:attr="onclick='pedirTurno(' + ${appointment.id} + ')'">
                        Solicitar turno
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="mt-4 d-flex justify-content-between">
        <button class="btn btn-secondary" onclick="window.history.back()">Volver Atrás</button>
        <button class="btn btn-secondary" onclick="window.location.href='/users/clients/home'">Volver al inicio</button>
    </div>
</div>

<script>
    function pedirTurno(id) {
      if (confirm("¿Estás seguro que deseas pedir el turno?")) {
        fetch('/calendar/' + id + '/pedir-turno', {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' }
        })
        .then(response => {
          if (response.ok) {
            alert("Turno pedido correctamente");
            location.reload();
          } else {
            alert("Error al pedir el turno");
          }
        })
        .catch(error => console.error("Error:", error));
      }
    }
</script>
</body>
</html>