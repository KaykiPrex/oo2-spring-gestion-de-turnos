<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" th:href="@{/css/appointment.css}">
</head>
<body>
<h1>Horarios disponibles</h1>
<table border="1">
  <thead>
  <tr>
    <th>ID</th>
    <th>Fecha</th>
    <th>Hora</th>
    <th>Profesional</th>
    <th>Cliente</th>
    <th>Pedir turno</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="appointment : ${professionalService.appointments}" th:if="${appointment.client == null}">
    <td th:text="${appointment.id}"></td>
    <td th:text="${appointment.date}"></td>
    <td th:text="${appointment.time}"></td>
    <td th:text="${appointment.professional.name}"></td>
    <td th:text="${appointment.client != null ? appointment.client.name : ''}"></td>
    <td>
      <button th:attr="onclick='pedirTurno(' + ${appointment.id} + ')'">
      Pedir turno
      </button>
    </td>
  </tr>
  </tbody>
</table>
<button onclick="window.history.back()">Volver Atrás</button>
</body>
</html>
<script>
  function pedirTurno(id) {
    if (confirm("¿Estás seguro que deseas pedir el turno?")) {
        fetch('/calendar/' + id + '/pedir-turno', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (response.ok) {
                alert("Turno pedido correctamente");
                location.reload();
            } else {
                alert("Error al pedir el turno");
            }
        })
        .catch(error => console.error("Error:", error));
    }
}
</script>